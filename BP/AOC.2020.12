CALL S.GET.INPUT(2020,12,INPUT.LINES)
INPUT.LINES.COUNT = DCOUNT(INPUT.LINES,@FM)

* Part 1
POS.X = 0
POS.Y = 0
FACING = 'E'
FACING.COORDS = 'N,S,E,W|0,180,90,270'
CONVERT '|,' TO @FM:@VM IN FACING.COORDS
FOR X = 1 TO INPUT.LINES.COUNT
  MOVE.DIR = INPUT.LINES<X>[1,1]
  MOVE.AMT = INPUT.LINES<X>[2,999]
  IF MOVE.DIR = 'F' THEN
    MOVE.DIR = FACING
  END
  BEGIN CASE
    CASE MOVE.DIR = 'N'
      POS.Y -= MOVE.AMT
    CASE MOVE.DIR = 'S'
      POS.Y += MOVE.AMT
    CASE MOVE.DIR = 'E'
      POS.X += MOVE.AMT
    CASE MOVE.DIR = 'W'
      POS.X -= MOVE.AMT
    CASE MOVE.DIR = 'R'
      LOCATE FACING IN FACING.COORDS<1> SETTING LOC THEN
        CUR.DIR = FACING.COORDS<2,LOC>
        CUR.DIR += MOVE.AMT
        LOOP
        WHILE CUR.DIR > 270
          CUR.DIR -= 360
        REPEAT
        LOCATE CUR.DIR IN FACING.COORDS<2> SETTING LOC THEN
          FACING = FACING.COORDS<1,LOC>
        END
      END
    CASE MOVE.DIR = 'L'
      LOCATE FACING IN FACING.COORDS<1> SETTING LOC THEN
        CUR.DIR = FACING.COORDS<2,LOC>
        CUR.DIR -= MOVE.AMT
        LOOP
        WHILE CUR.DIR < 0
          CUR.DIR += 360
        REPEAT
        LOCATE CUR.DIR IN FACING.COORDS<2> SETTING LOC THEN
          FACING = FACING.COORDS<1,LOC>
        END
      END
  END CASE
NEXT
* CRT 'POS.X=':POS.X:' POS.Y=':POS.Y
CRT 'Part 1 = ':ABS(POS.X)+ABS(POS.Y)


* Part 2
POS.X = 0
POS.Y = 0
WAYPOINT.X = 10
WAYPOINT.Y = -1
FOR X = 1 TO INPUT.LINES.COUNT
  MOVE.DIR = INPUT.LINES<X>[1,1]
  MOVE.AMT = INPUT.LINES<X>[2,999]
  OLD.WPX = WAYPOINT.X
  OLD.WPY = WAYPOINT.Y
  BEGIN CASE
    CASE MOVE.DIR = 'N'
      WAYPOINT.Y -= MOVE.AMT
    CASE MOVE.DIR = 'S'
      WAYPOINT.Y += MOVE.AMT
    CASE MOVE.DIR = 'E'
      WAYPOINT.X += MOVE.AMT
    CASE MOVE.DIR = 'W'
      WAYPOINT.X -= MOVE.AMT
    CASE MOVE.DIR = 'F'
      POS.X += WAYPOINT.X * MOVE.AMT
      POS.Y += WAYPOINT.Y * MOVE.AMT
    CASE MOVE.DIR = 'L'
      BEGIN CASE
        CASE MOVE.AMT = 90
          WAYPOINT.X = OLD.WPY
          WAYPOINT.Y = -OLD.WPX
        CASE MOVE.AMT = 180
          WAYPOINT.X = -WAYPOINT.X
          WAYPOINT.Y = -WAYPOINT.Y
        CASE MOVE.AMT = 270
          WAYPOINT.X = -OLD.WPY
          WAYPOINT.Y = OLD.WPX
      END CASE
    CASE MOVE.DIR = 'R'
      BEGIN CASE
        CASE MOVE.AMT = 90
          WAYPOINT.X = -OLD.WPY
          WAYPOINT.Y = OLD.WPX
        CASE MOVE.AMT = 180
          WAYPOINT.X = -WAYPOINT.X
          WAYPOINT.Y = -WAYPOINT.Y
        CASE MOVE.AMT = 270
          WAYPOINT.X = OLD.WPY
          WAYPOINT.Y = -OLD.WPX
      END CASE
  END CASE
NEXT
* CRT 'POS.X=':POS.X:' POS.Y=':POS.Y
CRT 'Part 2 = ':ABS(POS.X)+ABS(POS.Y)
